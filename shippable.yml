language: c

compiler:
  - gcc
  - clang

build:
  pre_ci:
    - sudo apt-get install automake autoconf libtool libssl-dev graphviz mscgen libpcap-dev gcc clang libcunit1-dev
  ci:
    - echo 1000 | sudo tee /proc/sys/vm/nr_hugepages
    - sudo mkdir -p /mnt/huge
    - sudo mount -t hugetlbfs nodev /mnt/huge
    - mkdir -p /dev/shm/odp
    - ./bootstrap
    - ./configure --disable-test-perf
    - make
    - sudo ODP_SHM_DIR=/dev/shm/odp make check

  on_failure:
    - cat config.log
    - find . -name 'test-suite.log' -execdir grep -il "FAILED" {} \; -exec echo {} \; -exec cat {} \;
